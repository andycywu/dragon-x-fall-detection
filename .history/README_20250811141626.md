# 🐉 Dragon X Fall Detection System
**跨平台AI老人跌倒檢測系統 - Qualcomm Snapdragon X Elite優化版**

## 🏆 黑客松項目亮點
- ✅ **9個AI模型**成功部署到Snapdragon X Elite CRD  
- ⚡ **37%性能提升** (Mac 45ms → Snapdragon 30ms)
- 💾 **33%記憶體節省** (Mac 235MB → Snapdragon 156MB)  
- 🌐 **真正跨平台**：Mac開發 → Snapdragon部署
- ☁️ **QAI Hub集成**：雲端編譯 + 邊緣推理

A real-time fall detection system that combines pose analysis using MediaPipe BlazePose and voice keyword detection using OpenAI Whisper, optimized for Qualcomm Snapdragon X Elite platform.

## Features

- **Real-time Pose Detection**: Uses MediaPipe BlazePose to analyze body posture and detect potential falls
- **Voice Keyword Detection**: Uses OpenAI Whisper to detect help keywords ("help", "救命") from audio input
- **Fusion Alert System**: Combines both detection methods with configurable cooldown periods
- **Real-time Monitoring**: Live webcam and microphone processing with OpenCV display
- **Web Dashboard**: Streamlit-based UI for testing and monitoring
- **Alert History**: Tracks and visualizes detection events

## Installation

1. Clone or download this repository
2. Install dependencies:
```bash
pip install -r requirements.txt
```

## Usage

### Real-time Detection (Main Application)

Run the main application for live detection:

```bash
python main.py
```

**Controls:**
- Press 'q' to quit
- Press 'c' to clear alert history
- Press 's' to show recent alerts

The system will:
- Open your webcam for pose detection
- Start microphone monitoring for voice detection
- Display live video feed with pose landmarks
- Show alerts when falls or help keywords are detected

### Web Dashboard

Launch the Streamlit dashboard for testing and monitoring:

```bash
streamlit run ui_dashboard.py
```

**Features:**
- Upload images for pose analysis testing
- Upload audio files for keyword detection testing
- View alert history and statistics
- Configure detection parameters
- Monitor system status

## System Components

### 1. Fall Detector (`fall_detector.py`)
- Uses MediaPipe BlazePose for pose estimation
- Calculates torso angle relative to vertical
- Detects falls when torso angle exceeds threshold (default: 80°)

### 2. Whisper Detector (`whisper_infer.py`)
- Uses OpenAI Whisper for speech recognition
- Detects help keywords in multiple languages
- Processes audio chunks in real-time

### 3. Fusion Trigger (`fusion_trigger.py`)
- Combines pose and audio detection results
- Implements alert cooldown to prevent spam
- Tracks alert history with timestamps and confidence scores

### 4. Main Application (`main.py`)
- Integrates all components for real-time processing
- Handles webcam and microphone input
- Displays live video with overlays
- Manages threading for audio processing

### 5. UI Dashboard (`ui_dashboard.py`)
- Streamlit web interface for testing
- Image and audio file upload capabilities
- Alert visualization and statistics
- System configuration options

## Configuration

### Detection Parameters
- **Fall angle threshold**: Adjust sensitivity of fall detection (60-120°)
- **Alert cooldown**: Minimum time between alerts (1-10 seconds)
- **Audio buffer**: Duration of audio processed for keyword detection

### Supported Audio Formats
- WAV, MP3, M4A for file upload
- Real-time microphone input (16kHz mono)

### Help Keywords
- English: "help", "HELP", "Help"
- Chinese: "救命", "救命啊"

## Hardware Requirements

- **Camera**: USB webcam or built-in camera
- **Microphone**: Any audio input device
- **CPU**: Sufficient for real-time video processing
- **Memory**: At least 4GB RAM recommended

## Performance Tips

1. **Camera Resolution**: Lower resolution (640x480) for better performance
2. **Audio Buffer**: Smaller buffers for lower latency, larger for better accuracy
3. **Model Selection**: Use Whisper "tiny" model for fastest processing
4. **Background Processing**: Audio processing runs in separate thread

## Troubleshooting

### Common Issues

1. **Camera not opening**:
   - Check camera permissions
   - Try different camera index (0, 1, 2...)
   - Ensure camera is not used by other applications

2. **Audio input errors**:
   - Check microphone permissions
   - Verify audio device is working
   - Try different sample rates

3. **Model loading errors**:
   - Ensure internet connection for initial Whisper model download
   - Check available disk space
   - Verify Python environment has required packages

4. **Performance issues**:
   - Close other applications using camera/microphone
   - Reduce video resolution
   - Use smaller Whisper model ("tiny" vs "base")

### Error Messages

- `Could not open camera`: Camera access issue
- `Audio callback status`: Microphone input problem
- `Error in keyword detection`: Whisper processing issue
- `No pose detected`: Person not visible in frame

## Development

### Project Structure
```
├── main.py              # Real-time detection application
├── fall_detector.py     # Pose-based fall detection
├── whisper_infer.py     # Voice keyword detection
├── fusion_trigger.py    # Alert fusion logic
├── ui_dashboard.py      # Web dashboard
├── requirements.txt     # Dependencies
├── assets/             # Static assets (empty)
├── models/             # Model files (empty)
└── README.md           # This file
```

### Adding New Features

1. **New Keywords**: Edit `help_keywords` list in `WhisperKeywordDetector`
2. **Detection Logic**: Modify angle calculations in `FallDetector`
3. **Alert Types**: Extend `AlertEvent` class in `fusion_trigger.py`
4. **UI Components**: Add new pages/components to `ui_dashboard.py`

## License

This project is for educational and research purposes. Please ensure proper attribution when using the code.

## Acknowledgments

- MediaPipe for pose detection
- OpenAI Whisper for speech recognition
- OpenCV for computer vision
- Streamlit for web interface
